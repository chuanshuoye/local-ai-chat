# 项目模块架构概述

## 模块组织
本项目采用功能模块化的组织结构，每个模块都专注于特定功能领域：
- **chat**: 核心聊天界面和交互功能
- **agents**: 智能代理创建和管理
- **docs**: 应用程序文档和帮助中心
- **mcp**: 模型控制面板，用于模型管理
- **workflow**: 自动化工作流程创建和执行
- **home**: 应用程序主页和导航中心



## Local AI Chat 应用架构设计

### 模块架构概述

Local AI Chat应用采用模块化架构设计，主要分为三个核心模块：Agent、Chat和Workflow。这三个模块紧密协作，提供完整的AI交互和自动化体验。

1. Agent 模块
Agent模块负责管理智能代理，让用户创建和配置可执行特定任务的AI代理。

数据结构
```typescript
interface Agent {
  id: string;
  name: string;
  type: string;
  description: string;
  icon: string;
  prompt: string;
  createdAt: number;
  updatedAt?: number;
  workflowId?: string; // 关联工作流
}
```
### 核心功能

- 代理创建与配置
- 代理类型管理
- 代理与工作流关联
- 代理执行监控

### 状态管理

使用Zustand+immer实现状态更新，通过persist实现本地持久化。提供完整的CRUD操作，支持与Workflow模块交互。

2. Chat 模块
Chat模块是用户与AI直接交互的核心界面，提供对话功能和消息管理。

数据结构

```typescript
interface ChatSession {
  id: string;
  title: string;
  createdAt: Date;
  updatedAt: Date;
  messages: Message[];
  assistantId?: string;
  context?: number[];
}

interface Assistant {
  id: string;
  name: string;
  description: string;
  icon: string;
  prompt: string;
  createdAt: Date;
  updatedAt: Date;
  isSystem?: boolean;
}
```
### 核心功能

- 会话创建与管理
- 消息发送与接收
- 流式响应处理
- 助手角色切换
- 消息历史保存

### 技术特点

- 基于SSE的消息流处理
- Markdown/代码高亮渲染
- 会话上下文管理
- 模型选择与参数配置

3. Workflow 模块
Workflow模块提供可视化工作流设计工具，让用户创建复杂的AI任务自动化流程。

数据结构

```typescript
interface Workflow {
  id: string;
  name: string;
  description?: string;
  nodes: Node<FlowNodeData>[];
  edges: Edge[];
  nodeConfigs: Record<string, any>;
  agentId?: string;
  type?: string;
  tags?: string[];
  createdAt: number;
  updatedAt: number;
}
```
### 核心功能
- 可视化工作流编辑器
- 节点拖拽和连接
- 与Agent模块集成
- 工作流执行与监控
- 节点配置管理

### 技术实现

- 基于react-flow-renderer的可视化编辑
- 节点模板与配置抽象
- 状态持久化与恢复

## 模块交互关系

三个模块间的关联与交互：

- Agent-Workflow关联：
    - Agent可以关联特定Workflow（通过workflowId字段）
    - Workflow可以关联特定Agent（通过agentId字段）
    - Agent页面提供直接跳转到关联Workflow的功能

- Chat-Agent关联：
    - Chat中的Assistant概念与Agent类似
    - Chat会话可以使用特定助手（通过assistantId字段）
    - 助手使用prompt字段定义角色行为

- 三模块协同流程：
    - 用户可创建Agent定义角色和行为
    - 使用Workflow设计Agent的工作流程
    - 在Chat中与Agent直接交互或触发工作流

## UI交互设计

### Agent模块UI

```text
+------------------------------------------+
|                                          |
|  Agent 管理                    [创建Agent] |
|                                          |
|  +----------------+ +----------------+   |
|  | 通用助手         | | 代码助手        |   |
|  | 回答各类问题...   | | 编程相关问题...  |   |
|  |                | |                |   |
|  | [编辑] [工作流]   | | [编辑] [工作流]  |   |
|  +----------------+ +----------------+   |
|                                          |
|  +----------------+ +----------------+   |
|  | 翻译助手         | | 写作助手        |   |
|  | 多语言翻译...    | | 文案创作...     |   |
|  |                | |                |   |
|  | [编辑] [工作流]   | | [编辑] [工作流]  |   |
|  +----------------+ +----------------+   |
|                                          |
+------------------------------------------+
```
### Chat模块UI

```text
+------------------------------------------+
|                                          |
|  聊天会话                      [新建会话]  |
|                                          |
|  +----------------+------------------+   |
|  |                                   |   |
|  | AI: 你好！我是AI助手，有什么可以帮助 |   |
|  | 你的吗？                          |   |
|  |                                   |   |
|  | 用户: 请解释一下React的生命周期     |   |
|  |                                   |   |
|  | AI: React的生命周期主要分为挂载、   |   |
|  | 更新和卸载三个阶段...              |   |
|  |                                   |   |
|  +-----------------------------------+   |
|                                          |
|  +-----------------------------------+   |
|  | [输入消息...]            [发送] 📎 |   |
|  +-----------------------------------+   |
|                                          |
|  模型: [llama3   ▼]  [✓] 流式响应        |
|                                          |
+------------------------------------------+
```

### Workflow模块UI

```text
+------------------------------------------+
|                                          |
|  工作流编辑器                 [管理工作流] |
|                                          |
|  +-----------------------------------+   |
|  | +--------+        +------------+ |   |
|  | | 输入    |------->| 分析文本    | |   |
|  | +--------+        +------------+ |   |
|  |      |                  |        |   |
|  |      |                  v        |   |
|  |      |            +------------+ |   |
|  |      |            | 提取关键词  | |   |
|  |      |            +------------+ |   |
|  |      |                  |        |   |
|  |      v                  v        |   |
|  | +--------+        +------------+ |   |
|  | | 搜索    |------->| 生成回复    | |   |
|  | +--------+        +------------+ |   |
|  |                         |        |   |
|  |                         v        |   |
|  |                   +------------+ |   |
|  |                   | 输出结果    | |   |
|  |                   +------------+ |   |
|  +-----------------------------------+   |
|                                          |
|  节点库:                                 |
|  [输入] [处理] [输出] [条件] [循环]       |
|                                          |
|  [保存工作流]               [测试执行]    |
+------------------------------------------+
```

### 系统整合图

```text

+------------------------------------------------------------+
|                       Local AI Chat                         |
+------------------------------------------------------------+
|                                                            |
|   +-------------+      +-------------+      +-------------+ |
|   |             |      |             |      |             | |
|   |    Agent    |<---->|  Workflow   |<---->|    Chat     | |
|   |             |      |             |      |             | |
|   +-------------+      +-------------+      +-------------+ |
|          ^                    ^                   ^         |
|          |                    |                   |         |
|          v                    v                   v         |
|   +-------------+      +-------------+      +-------------+ |
|   | agent-store |      |workflow-store|     | chat-store  | |
|   +-------------+      +-------------+      +-------------+ |
|                                                            |
|   +-----------------------+     +------------------------+ |
|   |      UI组件库          |     |   Zustand状态管理      | |
|   +-----------------------+     +------------------------+ |
|                                                            |
+------------------------------------------------------------+
```

## 技术架构总结
- 前端框架: Vite + React + TypeScript
- 样式: Tailwind CSS + radix-ui组件库
- 状态管理: Zustand + immer + persist
- 工作流: react-flow-renderer可视化编辑
- 数据存储: localStorage持久化
- API通信: Fetch API + SSE流式响应

## 技术栈
- Vite 作为构建工具
- React 用于UI组件开发
- TypeScript 确保类型安全
- Tailwind CSS 用于样式设计
- radix-ui 提供高级UI组件
- 模块化CSS以避免样式冲突

## 设计原则
1. **模块独立性**: 每个模块应当尽可能独立，减少跨模块依赖
2. **组件重用**: 抽取共用组件到全局组件库
3. **一致的用户体验**: 所有模块遵循相同的设计语言和交互模式
4. **性能优化**: 优先使用React Server Components，减少客户端状态
5. **响应式设计**: 所有界面都应适配不同设备尺寸


## 开发指南
- 使用功能型命名约定
- 采用移动优先的响应式设计
- 优化Web Vitals性能指标
- 使用nuqs进行URL参数状态管理
- 组件应自包含且可重用 

Local AI Chat应用通过模块化设计和状态管理，将Agent智能代理、Chat交互界面和Workflow自动化流程有机结合，为用户提供了一套完整的AI应用解决方案。系统设计注重组件重用、状态隔离和模块间松耦合，同时保持了必要的交互关联，实现了复杂功能的简洁实现。
